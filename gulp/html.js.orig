var gulp = require('gulp'),
    gutil = require('gulp-util'),
    htmlmin = require('gulp-htmlmin'),
<<<<<<< HEAD
    browserSync = require('browser-sync'),
=======
>>>>>>> release/2.2.0
    preprocess = require('gulp-preprocess'),
    htmlv = require('gulp-html-validator'),
    rename = require('gulp-rename');

//concat html to dev folder
gulp.task('html-dev', function () {
    return gulp.src(global.paths.htmlSrc + '/pages/*.html')
<<<<<<< HEAD
        .pipe(preprocess({context: {NODE_ENV: 'DEVELOPMENT', DEBUG: true, ROOT: '', THEME_PATH: 'wp-content/themes/amuz/', SEE: 'Link', DECACHE: Date.now()}}))
        .pipe(gulp.dest(global.paths.src));
    //browserSync.reload();
        //.pipe(browserSync.stream());
        //.pipe(browserSync.stream())
        //.on('error', gutil.log);
=======
        .pipe(preprocess({
            context: global.contextVarsDevelopment
        }))
        .pipe(gulp.dest(global.paths.src))
        .on('error', gutil.log);
>>>>>>> release/2.2.0
});

//run validation html
gulp.task('html-validator', function () {
    return gulp.src(global.paths.htmlSrc + '/pages/*.html')
        .pipe(preprocess({
            context: global.contextVarsDevelopment
        }))
        .pipe(htmlv({format: 'text'}))
        .pipe(rename({extname: '.txt'}))
        .pipe(gulp.dest('validator-results'));
});

//concat&minify html to static folder
gulp.task('html-deploy', function () {
    return gulp.src(global.paths.htmlSrc + '/pages/*.html')
        .pipe(preprocess({
            context: global.contextVarsDeploy
        }))
        .pipe(htmlmin({collapseWhitespace: true}))
        .pipe(gulp.dest(global.paths.dist));
});